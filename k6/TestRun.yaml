apiVersion: k6.io/v1alpha1
kind: TestRun
metadata:
  name: k6-to-prometheus
  namespace: perf
spec:
  parallelism: 1
  script:
    configMap:
      name: k6-script
      file: script.js

  # k6 실행 인자: Prometheus remote write 출력
  arguments:
    - "-o"
    - "experimental-prometheus-rw"

  runner:
    serviceAccountName: default
    env:
      - name: K6_PROMETHEUS_RW_SERVER_URL
        value: "http://kube-prometheus-stack-prometheus.monitoring:9090/api/v1/write"
      - name: K6_PROMETHEUS_RW_TREND_AS_NATIVE_HISTOGRAM
        value: "true"
