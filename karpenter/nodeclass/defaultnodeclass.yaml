apiVersion: karpenter.k8s.aws/v1
kind: EC2NodeClass
metadata:
  labels:
    architecture: amd64
    instance-family: t3a-preferred
  name: default-nodeclass
spec:
  amiFamily: AL2023
  amiSelectorTerms:
  - name: amazon-eks-node-al2023-x86_64-standard-1.33-*
  blockDeviceMappings:
  - deviceName: /dev/xvda
    ebs:
      deleteOnTermination: true
      encrypted: true
      volumeSize: 30Gi
      volumeType: gp3
  instanceStorePolicy: RAID0
  metadataOptions:
    httpEndpoint: enabled
    httpProtocolIPv6: disabled
    httpPutResponseHopLimit: 2
    httpTokens: optional
  role: ticket-cluster-karpenter-controller
  securityGroupSelectorTerms:
  - tags:
      karpenter.sh/discovery: ticket-cluster
  subnetSelectorTerms:
  - tags:
      karpenter.sh/discovery: ticket-cluster
  tags:
    Cluster: ticket-cluster
    ManagedBy: karpenter
  userData: |
    #!/bin/bash
    /etc/eks/bootstrap.sh ticket-cluster

    systemctl enable amazon-ssm-agent
    systemctl start amazon-ssm-agent
